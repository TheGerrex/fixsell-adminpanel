<div>
  <form [formGroup]="createPackageForm" class="section-card">
    <div class="section-card-header border-bottom">
      <div class="section-card-header-wrapper">
        <app-breadcrumb></app-breadcrumb>
        <h3 class="header-title">Nuevo Paquete de Renta</h3>
      </div>
      <div class="button-actions">
        <button
          ButtonResize
          class="button button-primary button-raised button-icon-text"
          (click)="submitForm()"
        >
          <mat-icon>add</mat-icon
          ><span class="button-label">Crear Paquete</span>
        </button>
      </div>
    </div>
    <app-loading-spinner [isLoading]="isSubmitting"></app-loading-spinner>
    <div class="section-card-body">
      <div class="form-container">
        <div class="form-grid">
          <!-- Printer -->
          <div class="form-item full-row">
            <mat-form-field appearance="outline">
              <mat-label>Multifuncional</mat-label>
              <input
                matInput
                type="text"
                placeholder="Agrega una multifuncional..."
                [formControl]="printerControl"
                [matAutocomplete]="auto"
              />
              <mat-error *ngIf="isValidField('printer')">{{
                getFieldError('printer')
              }}</mat-error>
            </mat-form-field>
            <mat-autocomplete
              #auto="matAutocomplete"
              (optionSelected)="addPrinterFromAutocomplete($event)"
              class="form-control"
            >
              <mat-option
                *ngFor="let printerName of filteredPrinterNames | async"
                [value]="printerName"
              >
                {{ printerName }}
              </mat-option>
            </mat-autocomplete>
          </div>

          <div class="form-item half-row">
            <mat-form-field appearance="outline">
              <mat-label>Fecha de Inicio</mat-label>
              <input
                matInput
                [matDatepicker]="ticketStartDatepicker"
                id="packageStartDate"
                formControlName="packageStartDate"
              />
              <mat-datepicker-toggle
                matIconSuffix
                [for]="ticketStartDatepicker"
              ></mat-datepicker-toggle>
              <mat-datepicker #ticketStartDatepicker>
                <mat-datepicker-actions>
                  <button mat-button matDatepickerCancel>Cancel</button>
                  <button mat-raised-button matDatepickerApply>Apply</button>
                </mat-datepicker-actions>
              </mat-datepicker>
              <mat-error *ngIf="isValidField('packageStartDate')">{{
                getFieldError('packageStartDate')
              }}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-item half-row">
            <mat-form-field appearance="outline">
              <mat-label>Fecha de Finalización</mat-label>
              <input
                matInput
                [matDatepicker]="ticketEndDatepicker"
                id="packageEndDate"
                formControlName="packageEndDate"
              />
              <mat-datepicker-toggle
                matIconSuffix
                [for]="ticketEndDatepicker"
              ></mat-datepicker-toggle>
              <mat-datepicker #ticketEndDatepicker>
                <mat-datepicker-actions>
                  <button mat-button matDatepickerCancel>Cancel</button>
                  <button mat-raised-button matDatepickerApply>Apply</button>
                </mat-datepicker-actions>
              </mat-datepicker>
              <mat-error *ngIf="isValidField('packageEndDate')">{{
                getFieldError('packageEndDate')
              }}</mat-error>
            </mat-form-field>
          </div>

          <!-- package price -->
          <div class="form-item half-row">
            <mat-form-field appearance="outline">
              <mat-label>Deposito Inicial</mat-label>
              <span matTextPrefix>$&nbsp;</span>
              <input
                matInput
                type="number"
                step="0.01"
                placeholder="2000"
                formControlName="packageDepositPrice"
              />
              <mat-select matTextSuffix formControlName="packageCurrency">
                <mat-option value="MXN">MXN</mat-option>
                <mat-option value="USD">USD</mat-option>
              </mat-select>

              <mat-error *ngIf="isValidField('packageDepositPrice')">{{
                getFieldError('packageDepositPrice')
              }}</mat-error>
            </mat-form-field>
          </div>

          <!-- package price -->
          <div class="form-item half-row">
            <mat-form-field appearance="outline">
              <mat-label>Pago mensual</mat-label>
              <span matTextPrefix>$&nbsp;</span>
              <input
                matInput
                type="number"
                step="0.01"
                placeholder="250"
                formControlName="packageMonthlyPrice"
              />
              <mat-select matTextSuffix formControlName="packageCurrency">
                <mat-option value="MXN">MXN</mat-option>
                <mat-option value="USD">USD</mat-option>
              </mat-select>

              <mat-error *ngIf="isValidField('packageMonthlyPrice')">{{
                getFieldError('packageMonthlyPrice')
              }}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-item half-row">
            <mat-form-field appearance="outline">
              <mat-label>Mensualidades</mat-label>
              <input
                matInput
                type="number"
                step="6"
                placeholder="2"
                formControlName="packageDuration"
              />
              <span matTextSuffix>meses</span>

              <mat-error *ngIf="isValidField('packageDuration')">{{
                getFieldError('packageDuration')
              }}</mat-error>
            </mat-form-field>
          </div>

          <!-- package discount percentage -->
          <div class="form-item half-row">
            <mat-form-field appearance="outline">
              <mat-label>Descuento</mat-label>
              <input
                matInput
                type="number"
                step="1"
                placeholder="20"
                formControlName="packageDiscountPercentage"
              />
              <span matTextSuffix>%</span>

              <mat-error *ngIf="isValidField('packageDiscountPercentage')">{{
                getFieldError('packageDiscountPercentage')
              }}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-item half-row">
            <mat-form-field appearance="outline">
              <mat-label>Impresiónes incluidas de B/N</mat-label>
              <input
                matInput
                type="number"
                step="100"
                placeholder="5000"
                formControlName="packagePrintsBw"
              />
              <span matTextSuffix>impresiónes</span>

              <mat-error *ngIf="isValidField('packagePrintsBw')">{{
                getFieldError('packagePrintsBw')
              }}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-item half-row">
            <mat-form-field appearance="outline">
              <mat-label>Costo por click extra de B/N</mat-label>
              <span matTextPrefix>$&nbsp;</span>
              <input
                matInput
                type="number"
                step="0.01"
                placeholder=".12"
                formControlName="packageExtraClickPriceBw"
              />

              <mat-error *ngIf="isValidField('packageExtraClickPriceBw')">{{
                getFieldError('packageExtraClickPriceBw')
              }}</mat-error>
            </mat-form-field>
          </div>

          <div *ngIf="selectedPrinter?.color" class="form-item half-row">
            <mat-form-field appearance="outline">
              <mat-label>Impresiónes incluidas de Color</mat-label>
              <input
                matInput
                type="number"
                step="100"
                placeholder="3500"
                formControlName="packagePrintsColor"
              />
              <span matTextSuffix>impresiónes</span>

              <mat-error *ngIf="isValidField('packagePrintsColor')">{{
                getFieldError('packagePrintsColor')
              }}</mat-error>
            </mat-form-field>
          </div>

          <div *ngIf="selectedPrinter?.color" class="form-item half-row">
            <mat-form-field appearance="outline">
              <mat-label>Costo por click extra de Color</mat-label>
              <span matTextPrefix>$&nbsp;</span>
              <input
                matInput
                type="number"
                step="0.01"
                placeholder=".25"
                formControlName="packageExtraClickPriceColor"
              />

              <mat-error *ngIf="isValidField('packageExtraClickPriceColor')">{{
                getFieldError('packageExtraClickPriceColor')
              }}</mat-error>
            </mat-form-field>
          </div>

          <!-- package description -->
          <div class="form-item full-row">
            <mat-form-field appearance="outline">
              <mat-label>Descripción</mat-label>
              <textarea
                matInput
                cdkTextareaAutosize
                placeholder="Descripción corta del paquete de renta..."
                #autosize="cdkTextareaAutosize"
                cdkAutosizeMinRows="1"
                cdkAutosizeMaxRows="2"
                formControlName="packageDescription"
              ></textarea>
              <mat-error *ngIf="isValidField('packageDescription')">{{
                getFieldError('packageDescription')
              }}</mat-error>
            </mat-form-field>
          </div>

          <!-- Package Includes Field -->
          <div class="form-item half-row">
            <h5>Condiciones del paquete incluye</h5>
            <div *ngFor="let option of predefinedOptions">
              <mat-checkbox
                [checked]="isChecked(option)"
                (change)="onCheckboxChange($event, option)"
              >
                {{ option }}
              </mat-checkbox>
            </div>
            <mat-checkbox
              *ngIf="!showCustomOptionInput"
              (change)="toggleCustomOptionInput()"
            >
              Agrega Otro
            </mat-checkbox>
            <div *ngIf="showCustomOptionInput" style="margin-top: 0.5rem">
              <mat-form-field appearance="outline">
                <mat-label>Nueva condición</mat-label>
                <input
                  matInput
                  [formControl]="customOptionControl"
                  (keydown.enter)="addCustomOption()"
                  placeholder="Escribe condición del paquete..."
                />
              </mat-form-field>
              <button
                type="button"
                class="button button-outline-primary"
                style="margin-top: 0.5rem"
                (click)="addCustomOption()"
              >
                <span class="button-label">Agregar</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
